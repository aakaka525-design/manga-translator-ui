<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manga Translator Web UI</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .user-login-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        .user-login-box {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.3);
            width: 400px;
        }
        .user-login-box h2 {
            margin-bottom: 20px;
            color: #2196F3;
        }
        .user-login-box input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #CFD8DC;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .user-login-error {
            color: red;
            margin-top: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobile-overlay"></div>

    <!-- User Login Screen -->
    <div id="user-login-screen" class="user-login-container">
        <div class="user-login-box">
            <h2>è¯·è¾“å…¥è®¿é—®å¯†ç </h2>
            <input type="password" id="user-password-input" placeholder="è¯·è¾“å…¥å¯†ç ">
            <button onclick="userLogin()" class="primary-btn large-btn">ç™»å½•</button>
            <div id="user-login-error" class="user-login-error"></div>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>Manga Translator</h1>
            <div class="header-controls">
                <span id="user-info" style="display: none; margin-right: 15px; color: #666;">
                    <span id="username-display"></span>
                </span>
                <button id="logout-btn" class="secondary-btn" style="display: none; margin-right: 10px;">æ³¨é”€</button>
                <a href="/admin" id="admin-link" class="admin-link" title="ç®¡ç†å‘˜é¢æ¿" style="display: none;">
                    <span>âš™ï¸</span>
                    <span id="admin-link-text">ç®¡ç†</span>
                </a>
                <select id="language-select" class="language-select">
                    <option value="zh_CN">ç®€ä½“ä¸­æ–‡</option>
                    <option value="zh_TW">ç¹é«”ä¸­æ–‡</option>
                    <option value="en_US">English</option>
                    <option value="ja_JP">æ—¥æœ¬èª</option>
                    <option value="ko_KR">í•œêµ­ì–´</option>
                    <option value="es_ES">EspaÃ±ol</option>
                </select>
                <!-- Mobile Settings Button - æ‰“å¼€è®¾ç½®é¢æ¿ -->
                <button class="mobile-menu-btn" id="mobile-menu-btn" style="display: none;" title="è®¾ç½®">âš™ï¸</button>
            </div>
        </header>

        <!-- Announcement Banner -->
        <div id="announcement-banner" style="display: none; padding: 15px; text-align: center; font-weight: 500;"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Panel -->
            <aside class="left-panel">
                <!-- File List Section -->
                <div class="panel-section file-section">
                    <div class="section-header">
                        <h3>æ–‡ä»¶åˆ—è¡¨</h3>
                        <div class="button-group">
                            <button id="add-files-btn" class="secondary-btn">æ·»åŠ æ–‡ä»¶</button>
                            <button id="add-folder-btn" class="secondary-btn">æ·»åŠ æ–‡ä»¶å¤¹</button>
                            <button id="clear-list-btn" class="secondary-btn">æ¸…ç©º</button>
                            <input type="file" id="file-input" multiple accept="image/*,.pdf,.json,.txt" style="display: none;">
                            <input type="file" id="folder-input" webkitdirectory directory multiple style="display: none;">
                        </div>
                    </div>
                    <div class="file-list-container">
                        <ul id="file-list" class="file-list">
                            <!-- File items will be added here -->
                        </ul>
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #666;">
                        <span id="file-count">0 ä¸ªæ–‡ä»¶</span>
                    </div>
                </div>

                <!-- Output Directory Section - Hidden in Web mode -->
                <div class="panel-section output-section" style="display: none;">
                    <h3>è¾“å‡ºç›®å½•</h3>
                    <div class="input-group">
                        <input type="text" id="output-dir" placeholder="é»˜è®¤è¾“å‡ºåˆ° result æ–‡ä»¶å¤¹">
                    </div>
                    <small class="hint">Web æ¨¡å¼ä¸‹æ–‡ä»¶å°†ç›´æ¥ä¸‹è½½åˆ°æµè§ˆå™¨</small>
                </div>

                <!-- Workflow Mode Section -->
                <div class="panel-section workflow-section">
                    <h3>ç¿»è¯‘å·¥ä½œæµæ¨¡å¼</h3>
                    <select id="workflow-mode" class="full-width-select">
                        <option value="normal">æ™®é€šç¿»è¯‘ (Normal Translation)</option>
                        <option value="export_trans">å¯¼å‡ºè¯‘æ–‡ (Export Translation)</option>
                        <option value="export_raw">å¯¼å‡ºåŸæ–‡ (Export Original Text)</option>
                        <option value="import_trans">å¯¼å…¥è¯‘æ–‡å¹¶æ¸²æŸ“ (Import Translation)</option>
                        <option value="colorize">ä»…ä¸Šè‰² (Colorize Only)</option>
                        <option value="upscale">ä»…è¶…åˆ† (Upscale Only)</option>
                        <option value="inpaint">ä»…ä¿®å¤ (Inpaint Only)</option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="panel-section action-section">
                    <button id="start-btn" class="primary-btn large-btn">å¼€å§‹ä»»åŠ¡</button>
                </div>

                <!-- Results Section -->
                <div class="panel-section results-section">
                    <div class="section-header">
                        <h3>ç¿»è¯‘ç»“æœ</h3>
                        <div class="button-group">
                            <button id="expand-results-btn" class="secondary-btn" style="display: none;" title="å±•å¼€å›¾ç‰‡æŸ¥çœ‹å™¨">ğŸ”</button>
                            <button id="download-all-btn" class="secondary-btn" style="display: none;">æ‰“åŒ…ä¸‹è½½</button>
                            <button id="clear-results-btn" class="secondary-btn" style="display: none;">æ¸…ç©º</button>
                        </div>
                    </div>
                    <div class="results-list-container">
                        <ul id="results-list" class="results-list">
                            <!-- Result items will be added here -->
                        </ul>
                        <div id="results-empty" class="empty-hint">æš‚æ— ç¿»è¯‘ç»“æœ</div>
                    </div>
                </div>

                <!-- History Section -->
                <div class="panel-section history-section">
                    <div class="section-header">
                        <h3>ç¿»è¯‘å†å²</h3>
                        <div class="button-group">
                            <button id="open-gallery-btn" class="secondary-btn" title="æ‰“å¼€ç›¸å†Œ" onclick="openHistoryGallery()">ğŸ“·</button>
                            <button id="refresh-history-btn" class="secondary-btn" title="åˆ·æ–°">ğŸ”„</button>
                        </div>
                    </div>
                    <div class="history-list-container" style="max-height: 150px; overflow-y: auto;">
                        <ul id="history-list" class="history-list" style="list-style: none; padding: 0; margin: 0;">
                            <!-- History items will be added here -->
                        </ul>
                        <div id="history-empty" class="empty-hint">æš‚æ— ç¿»è¯‘å†å²</div>
                    </div>
                </div>

                <!-- Config IO -->
                <div class="panel-section config-io-section">
                    <div class="button-group">
                        <button id="export-config-btn" class="secondary-btn">å¯¼å‡ºé…ç½®</button>
                        <button id="import-config-btn" class="secondary-btn">å¯¼å…¥é…ç½®</button>
                        <input type="file" id="config-input" accept=".json" style="display: none;">
                    </div>
                </div>
            </aside>

            <!-- Right Panel -->
            <section class="right-panel">
                <!-- Settings Tabs -->
                <div class="settings-container">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="basic">åŸºæœ¬è®¾ç½®</button>
                        <button class="tab-btn" data-tab="advanced">é«˜çº§è®¾ç½®</button>
                        <button class="tab-btn" data-tab="options">é€‰é¡¹</button>
                        <button class="tab-btn" data-tab="apikeys" id="apikeys-tab" style="display: none;">APIå¯†é’¥</button>
                    </div>
                    
                    <div class="tab-content-area">
                        <!-- Basic Settings -->
                        <div id="basic" class="tab-pane active">
                            <div class="settings-split">
                                <div class="settings-column" id="basic-left">
                                    <!-- Translator settings will go here -->
                                </div>
                                <div class="settings-column" id="basic-right">
                                    <!-- CLI/Other settings will go here -->
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Settings -->
                        <div id="advanced" class="tab-pane">
                            <div class="settings-split">
                                <div class="settings-column" id="advanced-left">
                                    <!-- Detector/Inpainter settings -->
                                </div>
                                <div class="settings-column" id="advanced-right">
                                    <!-- Render/Upscale/Colorizer settings -->
                                </div>
                            </div>
                        </div>

                        <!-- Options -->
                        <div id="options" class="tab-pane">
                            <div class="settings-split">
                                <div class="settings-column" id="options-left">
                                    <!-- OCR settings -->
                                </div>
                                <div class="settings-column" id="options-right">
                                    <!-- Global settings -->
                                    
                                    <!-- Font Upload Section -->
                                    <div id="font-upload-section" class="upload-section" style="display: none;">
                                        <h4>å­—ä½“ç®¡ç†</h4>
                                        <div class="upload-area">
                                            <input type="file" id="font-upload-input" accept=".ttf,.otf,.ttc" style="display: none;">
                                            <button id="font-upload-btn" class="secondary-btn">ä¸Šä¼ å­—ä½“æ–‡ä»¶</button>
                                            <p class="upload-hint">æ”¯æŒ TTF, OTF, TTC æ ¼å¼</p>
                                        </div>
                                        <div id="font-list-container" style="margin-top: 15px;">
                                            <h5 style="margin-bottom: 10px;">å·²ä¸Šä¼ çš„å­—ä½“</h5>
                                            <div id="font-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #E0E0E0; border-radius: 4px; padding: 10px;">
                                                <p style="color: #666;">åŠ è½½ä¸­...</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Prompt Upload Section -->
                                    <div id="prompt-upload-section" class="upload-section" style="display: none;">
                                        <h4>æç¤ºè¯ç®¡ç†</h4>
                                        <div class="upload-area">
                                            <input type="file" id="prompt-upload-input" accept=".json" style="display: none;">
                                            <button id="prompt-upload-btn" class="secondary-btn">ä¸Šä¼ æç¤ºè¯æ–‡ä»¶</button>
                                            <p class="upload-hint">æ”¯æŒ JSON æ ¼å¼</p>
                                        </div>
                                        <div id="prompt-list-container" style="margin-top: 15px;">
                                            <h5 style="margin-bottom: 10px;">å·²ä¸Šä¼ çš„æç¤ºè¯</h5>
                                            <div id="prompt-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #E0E0E0; border-radius: 4px; padding: 10px;">
                                                <p style="color: #666;">åŠ è½½ä¸­...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- API Keys -->
                        <div id="apikeys" class="tab-pane">
                            <div class="env-editor-container">
                                <p class="env-hint" id="env-hint-text">æ ¹æ®é€‰æ‹©çš„ç¿»è¯‘å™¨ï¼Œä¸‹æ–¹ä¼šæ˜¾ç¤ºæ‰€éœ€çš„ API å¯†é’¥è¾“å…¥æ¡†</p>
                                <div id="env-inputs-container"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Log Output -->
                <div class="log-container">
                    <div class="log-header">
                        <h3>æ—¥å¿—è¾“å‡º</h3>
                        <button id="clear-log-btn" class="icon-btn" title="æ¸…ç©ºæ—¥å¿—">ğŸ—‘ï¸</button>
                    </div>
                    <div id="log-box" class="log-box">
                        <!-- Logs will appear here -->
                    </div>
                </div>
            </section>
        </main>
    </div>
    <!-- Image Viewer Modal -->
    <div id="image-viewer-modal" class="modal" style="display: none;">
        <div class="modal-content image-viewer-content">
            <div class="modal-header">
                <h2>å›¾ç‰‡æŸ¥çœ‹å™¨</h2>
                <button class="close-btn" onclick="closeImageViewer()">Ã—</button>
            </div>
            <div class="image-viewer-body">
                <div class="thumbnails-panel">
                    <div id="thumbnails-container"></div>
                </div>
                <div class="preview-panel">
                    <div id="preview-container">
                        <div class="preview-placeholder">ç‚¹å‡»å·¦ä¾§ç¼©ç•¥å›¾æŸ¥çœ‹å¤§å›¾</div>
                    </div>
                    <div class="preview-info">
                        <span id="preview-filename"></span>
                        <div class="preview-actions">
                            <button id="preview-download-btn" class="secondary-btn" style="display: none;">ä¸‹è½½</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // è®¾ç½® pdf.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
    <script src="/static/js/history-gallery.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>
